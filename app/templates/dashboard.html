{% extends "base.html" %}
{% block title %}Dashboard - GolpoKotha{% endblock %}

{% block body %}
<div class="card">
  <h2>Welcome, {{ username }}!</h2>
  <p>Manage your content below. </p>
</div>

{% if my_posts %}
  {% for post in my_posts %}
  <article class="card" style="margin:  14px 0;">
    <h3><a href="{{ url_for('main.post_detail', post_id=post.id) }}" style="color:#fff; text-decoration: none;">{{ post.title }}</a></h3>
    <div class="post-meta">{{ post.date_posted.strftime('%Y-%m-%d') }}</div>
    <p>{{ post.content | striptags | truncate(150) }}</p>
    
    <div class="post-actions" style="display: flex; gap: 10px; align-items: center; margin-top: 15px;">
      <a href="{{ url_for('main.edit_post', post_id=post.id) }}" class="btn outline">Edit</a>
      <form action="{{ url_for('main.delete_post', post_id=post.id) }}" method="POST" style="margin:  0;" onsubmit="return confirm('Are you sure you want to delete this story?');">
        <button type="submit" class="btn" style="background:  #dc3545; border-color: #dc3545;">Delete</button>
      </form>
    </div>
  </article>
  {% endfor %}
  
  {% if p %}
  <div class="pagination">
    {% if p.has_prev %}
      <a href="{{ request.path }}?page={{ p. prev_num }}">&laquo; Prev</a>
    {% else %}
      <span>Start</span>
    {% endif %}
    {% for num in range(1, p.pages + 1) %}
      {% if num == p.page %}
        <span class="active">{{ num }}</span>
      {% else %}
        <a href="{{ request.path }}?page={{ num }}">{{ num }}</a>
      {% endif %}
    {% endfor %}
    {% if p.has_next %}
      <a href="{{ request.path }}? page={{ p.next_num }}">Next &raquo;</a>
    {% else %}
      <span>End</span>
    {% endif %}
  </div>
  {% endif %}
{% else %}
  <div class="card">
    <p>You haven't written any stories yet. </p>
    <a href="{{ url_for('main.new_post') }}" class="btn">Write Your First Story</a>
  </div>
{% endif %}

<style>
  .post-actions {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  .post-actions . btn {
    padding: 8px 20px;
    font-size: 14px;
  }
  .post-actions form {
    margin: 0;
    padding: 0;
  }
</style>
{% endblock %}